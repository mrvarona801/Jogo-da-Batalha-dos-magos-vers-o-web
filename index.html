<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Batalha dos Feiticeiros</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(to bottom, #0c0c1a, #1a1a3a);
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }

    .game-container {
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(100, 149, 237, 0.7);
    }

    .header h1 {
      font-size: 42px;
      background: linear-gradient(to right, #6495ed, #9370db);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .hud-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: rgba(44, 62, 80, 0.6);
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    .round-info,
    .turn-info {
      font-size: 18px;
      font-weight: bold;
      color: #ecf0f1;
    }

    .mana-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .mana-bar {
      width: 150px;
      height: 15px;
      background-color: #333;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      border: 1px solid #2c3e50;
    }

    .mana-fill {
      height: 100%;
      transition: width 0.5s ease;
    }

    /* ALTERA√á√ÉO: Mana do jogador em cor s√≥lida (azul) */
    .mana-container .mana-fill {
        background: #3498db; /* Azul S√≥lido */
    }

    /* NOVO: Estilo da Mana do Inimigo (para manter as barras locais consistentes) */
    .character .mana-bar {
        width: 100%;
        height: 12px;
    }
    .player .mana-fill { 
        background: #3498db; 
    }
    .enemy .mana-fill {
        background: #e74c3c; /* Vermelho S√≥lido */
    }


    .mana-text {
      font-size: 16px;
      font-weight: bold;
      text-shadow: 1px 1px 2px black;
    }

    .battle-area {
      display: flex;
      justify-content: space-between;
      /* ALTERA√á√ÉO: Alinha os personagens pela base da √°rea de batalha (ch√£o) */
      align-items: flex-end; 
      height: 500px;
      border-radius: 15px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      border: 2px solid #2c3e50;
    }

    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
      opacity: 0.8;
    }

    .character {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 250px;
      z-index: 2;
      transition: transform 0.3s;
      /* CORRE√á√ÉO: For√ßa o personagem para o ch√£o */
      align-self: flex-end; 
    }

    .character-image {
      width: 200px;
      height: 200px;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 15px;
      box-shadow: 0 0 20px rgba(52, 152, 219, 0.7);
      overflow: hidden;
      border: 3px solid #3498db;
      background: rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .character-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .enemy .character-image {
      box-shadow: 0 0 20px rgba(231, 76, 60, 0.7);
      border: 3px solid #e74c3c;
    }

    .stats-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        width: 100%;
    }

    .mana-container-local {
        width: 100%;
    }

    .hp-container {
      width: 100%;
      text-align: center;
      margin-top: 5px; /* Pequena separa√ß√£o entre mana e HP */
    }

    .hp-bar {
      width: 100%;
      height: 25px;
      background-color: #333;
      border-radius: 12px;
      overflow: hidden;
      margin-top: 10px;
      position: relative;
      border: 2px solid #2c3e50;
    }

    .hp-fill {
      height: 100%;
      background: linear-gradient(to right, #2ecc71, #27ae60);
      transition: width 0.5s ease;
      position: relative;
    }

    .hp-text {
      margin-top: 8px;
      font-size: 16px;
      font-weight: bold;
      text-shadow: 1px 1px 2px black;
    }

    /* ALTERA√á√ÉO: Novo grid para a√ß√µes (4 colunas) */
    .actions-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr); 
      gap: 15px;
      margin-top: 20px;
    }
    
    /* NOVO: Estilo para a linha separada do bot√£o Meditar */
    .utility-action {
        grid-column: 1 / 5; /* Ocupa as 4 colunas */
    }

    .action-btn {
      background: linear-gradient(to bottom, #3498db, #2980b9);
      border: none;
      border-radius: 10px;
      color: white;
      padding: 18px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
      text-align: left;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    /* ALTERA√á√ÉO: Novo estilo para Meditar - Mais sutil e roxo */
    .action-btn.meditate-btn {
        background: linear-gradient(to right, #6c5ce7, #a29bfe);
        text-align: center; /* Centraliza o texto quando ocupa a linha toda */
        box-shadow: 0 4px 10px rgba(108, 92, 231, 0.6);
        font-size: 20px;
        padding: 15px;
    }
    
    .action-btn.meditate-btn .action-stats {
        opacity: 1;
        font-size: 16px;
    }
    
    .action-btn.meditate-btn .action-name {
        margin-bottom: 5px;
    }


    .action-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    }

    .action-btn:active:not(:disabled) {
      transform: translateY(1px);
    }

    .action-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .action-name {
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 18px;
    }

    .action-stats {
      font-size: 14px;
      opacity: 0.9;
    }

    .action-cost {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .log-container {
      background-color: rgba(10, 10, 30, 0.85);
      border-radius: 10px;
      padding: 20px;
      height: 220px;
      overflow-y: auto;
      margin-top: 20px;
      border: 2px solid #34495e;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    }

    .log-entry {
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      animation: fadeIn 0.5s;
    }

    .game-over {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      animation: fadeIn 0.5s;
    }

    .game-over h2 {
      font-size: 60px;
      margin-bottom: 30px;
      text-shadow: 0 0 20px currentColor;
    }

    .game-over button {
      background: linear-gradient(to bottom, #e74c3c, #c0392b);
      border: none;
      border-radius: 10px;
      color: white;
      padding: 18px 35px;
      font-size: 20px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
      transition: all 0.3s;
    }

    .game-over button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(231, 76, 60, 0.7);
    }

    .hidden {
      display: none;
    }

    .animation {
      position: absolute;
      pointer-events: none;
      z-index: 10;
    }

    .damage-popup {
      position: absolute;
      color: #ff6b6b;
      font-weight: bold;
      font-size: 24px;
      text-shadow: 0 0 5px black;
      animation: floatUp 1s forwards;
      z-index: 20;
    }

    .heal-popup {
      position: absolute;
      color: #2ecc71;
      font-weight: bold;
      font-size: 24px;
      text-shadow: 0 0 5px black;
      animation: floatUp 1s forwards;
      z-index: 20;
    }

    .fire-animation {
      position: absolute;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, rgba(255,100,0,0.8) 0%, rgba(255,50,0,0) 70%);
      border-radius: 50%;
      animation: fireball 0.5s forwards;
      z-index: 5;
    }

    .ice-animation {
      position: absolute;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, rgba(100,200,255,0.8) 0%, rgba(100,150,255,0) 70%);
      border-radius: 50%;
      animation: iceball 0.5s forwards;
      z-index: 5;
    }

    .heal-animation {
      position: absolute;
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, rgba(100,255,100,0.6) 0%, rgba(50,200,50,0) 70%);
      border-radius: 50%;
      animation: heal 1s forwards;
      z-index: 5;
    }
    
    .meditate-animation {
      position: absolute;
      width: 180px;
      height: 180px;
      background: radial-gradient(circle, rgba(100,200,255,0.6) 0%, rgba(50,150,255,0) 70%);
      border-radius: 50%;
      animation: meditate 1.2s forwards;
      z-index: 5;
    }


    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    @keyframes floatUp {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(-50px); opacity: 0; }
    }

    @keyframes fireball {
      0% { transform: scale(0.5); opacity: 0.8; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }

    @keyframes iceball {
      0% { transform: scale(0.5); opacity: 0.8; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }

    @keyframes heal {
      0% { transform: scale(0.5); opacity: 0.8; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }
    
    @keyframes meditate {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }

    .shake {
      animation: shake 0.3s;
    }

    .pulse {
      animation: pulse 0.5s;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @media (max-width: 768px) {
      .battle-area {
        flex-direction: column;
        height: auto;
        padding: 10px;
      }

      .actions-container {
        grid-template-columns: 1fr;
      }
      
      .utility-action {
        grid-column: 1 / 2;
      }


      .character {
        margin-bottom: 30px;
      }

      .hud-container {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <h1>Batalha dos Feiticeiros</h1>
      <p>Escolha seu feiti√ßo e derrote o mago inimigo!</p>
    </div>

    <div class="hud-container">
      <div class="round-info" id="round-info">Rodada: 1</div>
      <div class="turn-info" id="turn-info">Sua vez</div>
    </div>

    <div class="battle-area">
      <img src="bg.jpg" alt="Cen√°rio de Batalha" class="background"/>

      <div class="character player">
        <div class="character-image" id="player-character">
          <img src="mage_blue.png" alt="Mago Azul" />
        </div>
        
        <div class="stats-container">
            <div class="mana-container-local">
                <div class="mana-text" id="player-mana-text" style="font-size: 14px;">Mana: 100/100</div>
                <div class="mana-bar">
                    <div class="mana-fill" id="player-mana-bar" style="width: 100%;"></div>
                </div>
            </div>
            
            <div class="hp-container">
              <div class="hp-bar">
                <div class="hp-fill" id="player-hp-bar" style="width: 100%;"></div>
              </div>
              <div class="hp-text" id="player-hp-text">100/100</div>
            </div>
        </div>
      </div>

      <div class="character enemy">
        <div class="character-image" id="enemy-character">
          <img src="mage_red.png" alt="Mago Vermelho" />
        </div>
        
        <div class="stats-container">
            <div class="mana-container-local">
                <div class="mana-text" id="enemy-mana-text" style="font-size: 14px;">Mana: 100/100</div>
                <div class="mana-bar">
                    <div class="mana-fill" id="enemy-mana-bar" style="width: 100%;"></div>
                </div>
            </div>
            
            <div class="hp-container">
              <div class="hp-bar">
                <div class="hp-fill" id="enemy-hp-bar" style="width: 100%;"></div>
              </div>
              <div class="hp-text" id="enemy-hp-text">100/100</div>
            </div>
        </div>
      </div>
    </div>

    <div class="actions-container" id="actions-container">
      </div>

    <div class="log-container" id="log-container">
      </div>
  </div>

  <div class="game-over hidden" id="game-over">
    <h2 id="game-result">Voc√™ venceu!</h2>
    <button id="restart-btn">Jogar Novamente</button>
  </div>

<script>
  const player = {
    hp: 100,
    maxHp: 100,
    mana: 100,
    maxMana: 100,
    manaRegen: 10
  };

  const enemy = {
    hp: 100,
    maxHp: 100,
    mana: 100,
    maxMana: 100,
    manaRegen: 10
  };

  const attacks = [
    { name: "Bola de Fogo", damage: 25, chance: 80, heal: 0, type: "fogo", manaCost: 20, animation: "fire" },
    { name: "Raio G√©lido", damage: 20, chance: 90, heal: 0, type: "gelo", manaCost: 15, animation: "ice" },
    { name: "Cura Divina", damage: 0, chance: 100, heal: 30, type: "cura", manaCost: 25, animation: "heal" },
    { name: "Explos√£o Arcana", damage: 60, chance: 50, heal: 0, type: "especial", manaCost: 40, animation: "fire" },
    { name: "Meditar", damage: 0, chance: 100, heal: 0, type: "meditar", manaCost: 0, manaGain: 30, animation: "meditate" } // Adicionado Meditar √† lista de ataques
  ];

  let round = 1;
  let playerTurn = true;
  let gameEnded = false;

  // DOM
  const playerHpBar = document.getElementById("player-hp-bar");
  const enemyHpBar = document.getElementById("enemy-hp-bar");
  const playerHpText = document.getElementById("player-hp-text");
  const enemyHpText = document.getElementById("enemy-hp-text");
  
  // DOM de Mana: Ambas as barras agora s√£o locais
  const playerManaBar = document.getElementById("player-mana-bar");
  const playerManaText = document.getElementById("player-mana-text");
  const enemyManaBar = document.getElementById("enemy-mana-bar");
  const enemyManaText = document.getElementById("enemy-mana-text");
  
  const actionsContainer = document.getElementById("actions-container");
  const logContainer = document.getElementById("log-container");
  const gameOverScreen = document.getElementById("game-over");
  const gameResult = document.getElementById("game-result");
  const restartBtn = document.getElementById("restart-btn");
  const roundInfo = document.getElementById("round-info");
  const turnInfo = document.getElementById("turn-info");
  const playerCharacter = document.getElementById("player-character");
  const enemyCharacter = document.getElementById("enemy-character");

  // Inicializa√ß√£o
  function initGame() {
    player.hp = 100;
    enemy.hp = 100;
    player.mana = 100;
    enemy.mana = 100;
    round = 1;
    playerTurn = true;
    gameEnded = false;

    updateUI();
    updateHUD();
    renderActions();
    logContainer.innerHTML = "";
    gameOverScreen.classList.add("hidden");
    
    addLog("‚öîÔ∏è A batalha come√ßou! √â sua vez.");
  }

  function updateHUD() {
    roundInfo.textContent = `Rodada: ${round}`;
    turnInfo.textContent = playerTurn ? "Sua vez" : "Turno do inimigo";
    
    // Mana do jogador (agora local)
    playerManaText.textContent = `Mana: ${player.mana}/${player.maxMana}`;
    playerManaBar.style.width = `${(player.mana / player.maxMana) * 100}%`;
    
    // Mana do inimigo (local)
    enemyManaText.textContent = `Mana: ${enemy.mana}/${enemy.maxMana}`;
    enemyManaBar.style.width = `${(enemy.mana / enemy.maxMana) * 100}%`;
  }

  function renderActions() {
    actionsContainer.innerHTML = "";
    attacks.forEach((atk, index) => {
      const btn = document.createElement("button");
      btn.classList.add("action-btn");
      
      const hasMana = player.mana >= atk.manaCost;
      btn.disabled = !playerTurn || gameEnded || !hasMana;
      
      let statsText;
      if (atk.type === "meditar") {
          // NOVO: Adiciona classe de utilidade e estiliza
          btn.classList.add("meditate-btn", "utility-action");
          statsText = `Recupera ${atk.manaGain} de Mana`;
          // Remove o custo (que √© 0) para a medita√ß√£o
          btn.innerHTML = `
            <div class="action-name">${atk.name}</div>
            <div class="action-stats">${statsText}</div>
          `;
      } else {
          // A√ß√µes normais de ataque/cura
          statsText = `${atk.damage > 0 ? `Dano: ${atk.damage}` : `Cura: ${atk.heal}`} | ${atk.chance}% chance`;
          btn.innerHTML = `
            <div class="action-name">${atk.name}</div>
            <div class="action-stats">${statsText}</div>
            <div class="action-cost">${atk.manaCost}</div>
          `;
      }
      
      btn.onclick = () => handlePlayerAction(index);
      actionsContainer.appendChild(btn);
    });
  }

  function handlePlayerAction(index) {
    if (!playerTurn || gameEnded) return;
    const action = attacks[index];

    if (player.mana < action.manaCost) {
      addLog("‚ö†Ô∏è Voc√™ n√£o tem mana suficiente para este feiti√ßo!");
      return;
    }

    if (action.type === "meditar") {
        player.mana = Math.min(player.maxMana, player.mana + action.manaGain);
        addLog("üíß Voc√™ medita e recupera sua energia!");
        createAnimation("meditate", playerCharacter, true); 
    } else {
        player.mana -= action.manaCost;
        executeAction(action, player, enemy, "Voc√™", "Inimigo", true);
    }

    // Regenerar mana passivamente (se n√£o meditou)
    if (action.type !== "meditar") {
        player.mana = Math.min(player.maxMana, player.mana + player.manaRegen);
    }
    
    updateHUD();

    playerTurn = false;
    updateHUD();
    renderActions();

    if (!gameEnded) {
      setTimeout(() => enemyTurn(), 2000);
    }
  }

  function enemyTurn() {
    if (gameEnded) return;

    // Regenerar mana no in√≠cio do turno do inimigo
    enemy.mana = Math.min(enemy.maxMana, enemy.mana + enemy.manaRegen);

    let offensiveAttacks = attacks.filter(atk => atk.type !== "meditar");
    let availableAttacks = offensiveAttacks.filter(atk => enemy.mana >= atk.manaCost);

    // üßò‚Äç‚ôÇÔ∏è Caso n√£o tenha mana suficiente, o inimigo medita (vers√£o da IA)
    if (availableAttacks.length === 0) {
      const meditateAction = attacks.find(a => a.type === "meditar");
      enemy.mana = Math.min(enemy.maxMana, enemy.mana + meditateAction.manaGain);
      addLog("üíß O inimigo medita e recupera sua energia!");
      createAnimation("meditate", enemyCharacter, false); 
      updateHUD(); 
      
      // Passa para o pr√≥ximo turno
      playerTurn = true;
      round++;
      updateHUD();
      renderActions();
      return;
    }

    const action = availableAttacks[Math.floor(Math.random() * availableAttacks.length)];
    enemy.mana -= action.manaCost;
    
    // IA simples: Evita cura se HP estiver cheio
    if (action.type === "cura" && enemy.hp === enemy.maxHp) {
        let filtered = availableAttacks.filter(atk => atk.type !== "cura");
        if (filtered.length > 0) {
            const newAction = filtered[Math.floor(Math.random() * filtered.length)];
            enemy.mana += action.manaCost; // Devolve o custo da cura
            enemy.mana -= newAction.manaCost;
            executeAction(newAction, enemy, player, "Inimigo", "Voc√™", false);
        } else {
            // Se s√≥ tiver cura e HP cheio, ele usa mesmo assim (melhor do que nada)
            executeAction(action, enemy, player, "Inimigo", "Voc√™", false);
        }
    } else {
        executeAction(action, enemy, player, "Inimigo", "Voc√™", false);
    }


    // Regenerar mana do jogador (passivo)
    player.mana = Math.min(player.maxMana, player.mana + player.manaRegen);

    playerTurn = true;
    round++;
    updateHUD();
    renderActions();
  }

  function executeAction(action, attacker, target, attackerName, targetName, isPlayer) {
    const isHeal = action.heal > 0;
    const isHit = Math.random() * 100 <= action.chance;
    let log = "";

    createAnimation(action.animation, isPlayer ? enemyCharacter : playerCharacter, isPlayer);

    if (isHit) {
      if (isHeal) {
        const healAmount = action.heal;
        attacker.hp = Math.min(attacker.hp + healAmount, attacker.maxHp);
        log = `${attackerName} usou <strong>${action.name}</strong> e recuperou ${healAmount} de HP!`;
        createPopup(isPlayer ? playerCharacter : enemyCharacter, `+${healAmount}`, "heal");
        const attackerElement = isPlayer ? playerCharacter : enemyCharacter;
        attackerElement.classList.add("pulse"); 
        setTimeout(() => attackerElement.classList.remove("pulse"), 500);
      } else {
        const damageAmount = action.damage;
        target.hp = Math.max(target.hp - damageAmount, 0);
        log = `${attackerName} usou <strong>${action.name}</strong> e causou ${damageAmount} de dano em ${targetName}!`;
        createPopup(isPlayer ? enemyCharacter : playerCharacter, `-${damageAmount}`, "damage");
        const targetElement = isPlayer ? enemyCharacter : playerCharacter;
        targetElement.classList.add("shake");
        setTimeout(() => targetElement.classList.remove("shake"), 300);
      }
    } else {
      log = `${attackerName} tentou usar <strong>${action.name}</strong>, mas errou!`;
    }

    addLog(log);
    updateUI();
    checkGameOver();
  }

  function createAnimation(type, targetElement, isPlayer) {
    const battleArea = document.querySelector('.battle-area');
    const battleRect = battleArea.getBoundingClientRect();
    const animationElement = document.createElement('div');

    switch (type) {
      case "fire": animationElement.className = "fire-animation"; break;
      case "ice": animationElement.className = "ice-animation"; break;
      case "heal": animationElement.className = "heal-animation"; break;
      case "meditate": animationElement.className = "meditate-animation"; break;
      default: animationElement.className = "fire-animation";
    }

    // Posi√ß√£o base da anima√ß√£o
    if (type === "meditate" || type === "heal") {
      // Centraliza no personagem
      const rect = targetElement.getBoundingClientRect();
      const characterRect = targetElement.querySelector('img').getBoundingClientRect(); // Usa a imagem para posicionamento exato
      animationElement.style.left = `${characterRect.left - battleRect.left + characterRect.width / 2 - 90}px`;
      animationElement.style.top = `${characterRect.top - battleRect.top + characterRect.height / 2 - 90}px`;
    } else if (isPlayer) {
      // Anima√ß√£o indo do jogador (esquerda) para o inimigo (direita)
      const targetRect = enemyCharacter.getBoundingClientRect();
      const targetImageRect = enemyCharacter.querySelector('img').getBoundingClientRect();
      animationElement.style.left = `${targetImageRect.left - battleRect.left + targetImageRect.width / 2 - 50}px`;
      animationElement.style.top = `${targetImageRect.top - battleRect.top + targetImageRect.height / 2 - 50}px`;
    } else {
      // Anima√ß√£o indo do inimigo (direita) para o jogador (esquerda)
      const targetRect = playerCharacter.getBoundingClientRect();
      const targetImageRect = playerCharacter.querySelector('img').getBoundingClientRect();
      animationElement.style.left = `${targetImageRect.left - battleRect.left + targetImageRect.width / 2 - 50}px`;
      animationElement.style.top = `${targetImageRect.top - battleRect.top + targetImageRect.height / 2 - 50}px`;
    }

    battleArea.appendChild(animationElement);
    setTimeout(() => animationElement.remove(), 1200);
  }

  function createPopup(targetElement, text, type) {
    const rect = targetElement.getBoundingClientRect();
    const battleArea = document.querySelector('.battle-area');
    const battleRect = battleArea.getBoundingClientRect();
    const popup = document.createElement('div');
    popup.className = type === "damage" ? "damage-popup" : "heal-popup";
    popup.textContent = text;
    // Posi√ß√£o ajustada ligeiramente acima do alvo
    popup.style.left = `${rect.left - battleRect.left + rect.width / 2}px`;
    popup.style.top = `${rect.top - battleRect.top - 20}px`;
    battleArea.appendChild(popup);
    setTimeout(() => popup.remove(), 1000);
  }

  function updateUI() {
    // Atualiza HP e Mana do jogador (ambos locais)
    playerHpBar.style.width = `${(player.hp / player.maxHp) * 100}%`;
    playerHpText.textContent = `${player.hp}/${player.maxHp}`;
    updateHpBarColor(playerHpBar, player.hp, player.maxHp);
    
    // Atualiza HP e Mana do inimigo (ambos locais)
    enemyHpBar.style.width = `${(enemy.hp / enemy.maxHp) * 100}%`;
    enemyHpText.textContent = `${enemy.hp}/${enemy.maxHp}`;
    updateHpBarColor(enemyHpBar, enemy.hp, enemy.maxHp);
    
    // Atualiza o texto e a barra de mana (agora na fun√ß√£o updateHUD)
    updateHUD(); 
  }

  function updateHpBarColor(barElement, currentHp, maxHp) {
    const percentage = (currentHp / maxHp) * 100;
    let colorGradient;
    
    if (percentage > 50) {
      colorGradient = "linear-gradient(to right, #2ecc71, #27ae60)"; // Verde (Alto)
    } else if (percentage > 25) {
      colorGradient = "linear-gradient(to right, #f39c12, #e67e22)"; // Amarelo/Laranja (M√©dio)
    } else {
      colorGradient = "linear-gradient(to right, #e74c3c, #c0392b)"; // Vermelho (Baixo)
    }
    
    barElement.style.background = colorGradient;
  }

  function addLog(message) {
    const entry = document.createElement("div");
    entry.className = "log-entry";
    entry.innerHTML = message;
    logContainer.prepend(entry);
    while (logContainer.children.length > 20) {
      logContainer.removeChild(logContainer.lastChild);
    }
  }

  function checkGameOver() {
    if (player.hp <= 0 || enemy.hp <= 0) {
      gameEnded = true;
      gameOverScreen.classList.remove("hidden");
      if (player.hp > 0) {
        gameResult.textContent = "Voc√™ venceu!";
        gameResult.style.color = "#2ecc71";
      } else {
        gameResult.textContent = "Voc√™ perdeu!";
        gameResult.style.color = "#e74c3c";
      }
      renderActions(); // Desabilita os bot√µes
    }
  }

  restartBtn.onclick = () => initGame();
  initGame();
</script>
</body>
</html>